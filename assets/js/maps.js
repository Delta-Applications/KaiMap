const maps=(()=>{""!=settings[1]?caching_time=864e5*Number(settings[1]):caching_time=864e5,""==settings[3]||null==settings[3]&&null==settings[3]?zoom_depth=12:zoom_depth=localStorage.getItem("cache-zoom");let e,a,t,o,r=function(){tilesLayer.on("tilecachehit",(function(e){})),tilesLayer.on("tilecachemiss",(function(e){})),tilesLayer.on("tilecacheerror",(function(e){}))};function i(e,a){const t={mm:e.getMonth()+1,dd:e.getDate(),yy:e.getFullYear().toString().slice(-2),yyyy:e.getFullYear()};return a.replace(/mm|dd|yy|yyy/gi,(e=>t[e]))}let n,s,m,p,l,c,y=new L.FeatureGroup,h=!1;return{opencycle_map:function(){kaiosToaster({message:"OpenCycleMap",position:"north",type:"info",timeout:2e3}),kaiads.DisplayFullScreenAd(),tilesUrl="https://tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=c88c645ad8f64411bef71105c00710bc",tilesLayer=L.tileLayer(tilesUrl,{useCache:!0,saveToCache:!1,crossOrigin:!0,cacheMaxAge:caching_time,useOnlyCache:!1,maxZoom:17,attribution:"OpenCycleMap"}),map.addLayer(tilesLayer),r()},moon_map:function(){tilesUrl="https://cartocdn-gusc.global.ssl.fastly.net/opmbuilder/api/v1/map/named/opm-moon-basemap-v0-1/all/{z}/{x}/{y}.png",tilesLayer=L.tileLayer(tilesUrl,{useCache:!0,saveToCache:!1,crossOrigin:!0,cacheMaxAge:caching_time,useOnlyCache:!1,maxZoom:12,minZoom:2,attribution:"Moon Map"}),map.addLayer(tilesLayer),r()},earthquake_layer:function(){if(map.hasLayer(y))return map.removeLayer(y),kaiosToaster({message:"Removed Layer",position:"north",type:"error",timeout:1e3}),!1;kaiosToaster({message:"Earthquakes",position:"north",type:"info",timeout:2e3});const e=new Date,a=new Date(Date.now()-864e5);console.log(i(a,"yy-mm-dd")),fetch("https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime="+i(a,"yy-mm-dd")+"&endtime="+i(e,"yy-mm-dd")).then((function(e){return e.json()})).then((function(e){kaiosToaster({message:"Earthquakes Layer",position:"north",type:"info",timeout:2e3}),L.geoJSON(e,{pointToLayer:function(e,a){"earthquake"==e.properties.type&&(L.marker(a,{icon:L.divIcon({html:'<i class="eq-marker" style="color: red"></i>',iconSize:[10,10],className:"earthquake-marker"})}).openTooltip().addTo(y),map.addLayer(y),windowOpen="map")},onEachFeature:function(e,a){console.log(e)}}).addTo(map)}))},satellite_map:function(){kaiosToaster({message:"Bing Aerial",position:"north",type:"info",timeout:2e3}),kaiads.DisplayFullScreenAd(),tilesLayer=new L.tileLayer.bing("AplJXxD16sIAeNH3ZGeiYehGslopIApKbc6BwKFD8TJrOkvdEjUQ1nUQv178Gazx"),map.addLayer(tilesLayer),r()},toner_map:function(){kaiosToaster({message:"Toner Map",position:"north",type:"info",timeout:2e3}),tilesUrl="https://stamen-tiles.a.ssl.fastly.net/toner/{z}/{x}/{y}.png",tilesLayer=L.tileLayer(tilesUrl,{useCache:!0,saveToCache:!1,crossOrigin:!0,cacheMaxAge:caching_time,useOnlyCache:!1,maxZoom:18,attribution:"Toner Map"}),map.addLayer(tilesLayer),r()},google_map:function(){kaiosToaster({message:"Google Street",position:"north",type:"info",timeout:2e3}),kaiads.DisplayFullScreenAd(),tilesUrl="http://mt1.google.com/vt/lyrs=m@146&hl=en&x={x}&y={y}&z={z}",tilesLayer=L.tileLayer(tilesUrl,{useCache:!0,saveToCache:!1,crossOrigin:!0,cacheMaxAge:caching_time,useOnlyCache:!1,minZoom:0,maxZoom:18,format:"image/jpeg",attribution:"Google Street"}),map.addLayer(tilesLayer),r()},opentopo_map:function(){kaiosToaster({message:"OpenTopoMap",position:"north",type:"info",timeout:2e3}),kaiads.DisplayFullScreenAd(),tilesUrl="https://tile.opentopomap.org/{z}/{x}/{y}.png",tilesLayer=L.tileLayer(tilesUrl,{useCache:!0,saveToCache:!1,crossOrigin:!0,cacheMaxAge:caching_time,useOnlyCache:!1,maxZoom:17,attribution:"OpenTopoMap"}),map.addLayer(tilesLayer),r()},owm_precipit_layer:function(){if(map.hasLayer(e))return map.removeLayer(e),kaiosToaster({message:"Removed Layer",position:"north",type:"error",timeout:1e3}),!1;kaiosToaster({message:"OWM Precipitation",position:"north",type:"info",timeout:2e3}),tilesUrl="https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=99d2594c090c1ee9a8ad525fd7a83f85",e=L.tileLayer(tilesUrl,{useCache:!0,saveToCache:!1,crossOrigin:!0,cacheMaxAge:caching_time,useOnlyCache:!1,maxZoom:18,attribution:"OpenWeatherMap"}),map.addLayer(e),r()},owm_wind_layer:function(){if(map.hasLayer(a))return map.removeLayer(a),kaiosToaster({message:"Removed Layer",position:"north",type:"error",timeout:1e3}),!1;kaiosToaster({message:"OWM Wind",position:"north",type:"info",timeout:2e3}),tilesUrl="https://tile.openweathermap.org/map/wind_new/{z}/{x}/{y}.png?appid=99d2594c090c1ee9a8ad525fd7a83f85",a=L.tileLayer(tilesUrl,{useCache:!0,saveToCache:!1,crossOrigin:!0,cacheMaxAge:caching_time,useOnlyCache:!1,maxZoom:18,attribution:"OpenWeatherMap"}),map.addLayer(a),r()},owm_temp_layer:function(){if(map.hasLayer(t))return map.removeLayer(t),kaiosToaster({message:"Removed Layer",position:"north",type:"error",timeout:1e3}),!1;kaiosToaster({message:"OWM Temperature",position:"north",type:"info",timeout:2e3}),tilesUrl="https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid=99d2594c090c1ee9a8ad525fd7a83f85",t=L.tileLayer(tilesUrl,{useCache:!0,saveToCache:!1,crossOrigin:!0,cacheMaxAge:caching_time,useOnlyCache:!1,maxZoom:18,attribution:"OpenWeatherMap"}),map.addLayer(t),r()},osm_map:function(){kaiosToaster({message:"OpenStreetMap",position:"north",type:"info",timeout:2e3}),tilesUrl="https://tile.openstreetmap.org/{z}/{x}/{y}.png",tilesLayer=L.tileLayer(tilesUrl,{useCache:!0,saveToCache:!1,crossOrigin:!0,cacheMaxAge:caching_time,useOnlyCache:!1,maxZoom:18,attribution:"OpenStreetMap"}),map.addLayer(tilesLayer),r()},weather_map:function(){let e;if(kaiads.DisplayFullScreenAd(),1==h)return top_bar("","",""),map.removeLayer(s),map.removeLayer(m),map.removeLayer(p),map.removeLayer(l),map.removeLayer(c),kaiosToaster({message:"Removed Layer",position:"north",type:"error",timeout:1e3}),clearInterval(n),h=!1,!1;fetch("https://api.rainviewer.com/public/maps.json").then((function(e){return h=!0,kaiosToaster({message:"Rainviewer",position:"north",type:"info",timeout:2e3}),e.json()})).then((function(a){e="https://tilecache.rainviewer.com/v2/radar/"+a[a.length-5]+"/256/{z}/{x}/{y}/2/1_1.png",s=L.tileLayer(e),weather_url0="https://tilecache.rainviewer.com/v2/radar/"+a[a.length-4]+"/256/{z}/{x}/{y}/2/1_1.png",m=L.tileLayer(e),weather_url1="https://tilecache.rainviewer.com/v2/radar/"+a[a.length-3]+"/256/{z}/{x}/{y}/2/1_1.png",p=L.tileLayer(weather_url1),weather_url2="https://tilecache.rainviewer.com/v2/radar/"+a[a.length-2]+"/256/{z}/{x}/{y}/2/1_1.png",l=L.tileLayer(weather_url2),weather_url3="https://tilecache.rainviewer.com/v2/radar/"+a[a.length-1]+"/256/{z}/{x}/{y}/2/1_1.png",c=L.tileLayer(weather_url3),L.tileLayer("https://tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:18}),map.addLayer(s),map.addLayer(m),map.addLayer(p),map.addLayer(l),map.addLayer(c);let t=-1;n=setInterval((()=>{t++,0==t&&(map.addLayer(s),map.removeLayer(m),map.removeLayer(p),map.removeLayer(l),map.removeLayer(c),"map"==windowOpen&&top_bar("",moment.unix(a[a.length-4]).format("DD.MM.YYYY, HH:MM:SS"),"")),1==t&&(map.removeLayer(s),map.addLayer(m),map.removeLayer(p),map.removeLayer(l),map.removeLayer(c),"map"==windowOpen&&top_bar("",moment.unix(a[a.length-4]).format("DD.MM.YYYY, HH:MM:SS"),"")),2==t&&(map.removeLayer(s),map.removeLayer(m),map.addLayer(p),map.removeLayer(l),map.removeLayer(c),"map"==windowOpen&&top_bar("",moment.unix(a[a.length-3]).format("DD.MM.YYYY, HH:MM:SS"),"")),3==t&&(map.removeLayer(s),map.removeLayer(m),map.removeLayer(p),map.addLayer(l),map.removeLayer(c),"map"==windowOpen&&top_bar("",moment.unix(a[a.length-2]).format("DD.MM.YYYY, HH:MM:SS"),"")),4==t&&(map.removeLayer(s),map.removeLayer(m),map.removeLayer(p),map.removeLayer(l),map.addLayer(c),"map"==windowOpen&&top_bar("",moment.unix(a[a.length-1]).format("DD.MM.YYYY, HH:MM:SS"),"")),5==t&&(t=0)}),2e3)})).catch((function(e){toaster("Failed to load weather data",3e3)}))},railway_layer:function(){if(map.hasLayer(o))return map.removeLayer(o),kaiosToaster({message:"Removed Layer",position:"north",type:"error",timeout:1e3}),!1;kaiosToaster({message:"Railways",position:"north",type:"info",timeout:2e3}),tilesUrl="https://{s}.tiles.openrailwaymap.org/standard/{z}/{x}/{y}.png",o=L.tileLayer(tilesUrl,{useCache:!0,saveToCache:!1,crossOrigin:!0,cacheMaxAge:caching_time,useOnlyCache:!1,maxZoom:18,attribution:"OpenRailwayMap"}),map.addLayer(o),tt=!0,r()},caching_tiles:function(){let e=map.getBounds()._southWest.lat,a=map.getBounds()._southWest.lng,t=map.getBounds()._northEast.lat,o=map.getBounds()._northEast.lng;var r=L.latLngBounds(L.latLng(e,a),L.latLng(t,o));tilesLayer.seed(r,0,zoom_depth),"map"==windowOpen&&top_bar("","Downloading",""),screenWakeLock("lock"),tilesLayer.on("seedprogress",(function(e){var a=100-Math.floor(e.remainingLength/e.queueLength*100);console.log("Seeding "+a+"% done"),"map"==windowOpen&&(document.querySelector("div#top-bar div.button-center").innerText="Caching "+a+"% done ("+(e.queueLength-e.remainingLength)+"/"+e.queueLength+")")})),tilesLayer.on("seedend",(function(e){setTimeout((()=>{"map"==windowOpen&&top_bar("","",""),kaiosToaster({message:"Finished caching",position:"north",type:"success",timeout:2e3}),screenWakeLock("unlock")}),2e3)})),tilesLayer.on("tilecacheerror",(function(e){kaiosToaster({message:"Cache Error @ "+e.tile+": "+e.error,position:"north",type:"error",timeout:2e3})})),tilesLayer.on("error",(function(e){top_bar("","",""),screenWakeLock("unlock"),kaiosToaster({message:"Failed caching: "+e,position:"north",type:"error",timeout:2e3})})),tilesLayer.on("seedstart",(function(e){}))},delete_cache:function(){tilesLayer._db.destroy().then((function(e){toaster("Cache Cleared",3e3)})).catch((function(e){console.log(e)}))}}})();
